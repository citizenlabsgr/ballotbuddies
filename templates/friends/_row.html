<tr class="align-middle {% if not voter.complete %} text-muted {% endif %}">

    <th scope="row">
        <a class="text-reset text-decoration-none" href="{% url 'buddies:friends-profile' slug=voter.slug %}">
        <span class="d-block d-sm-none" {% if "@" in voter.display_name %}style="word-break: break-all;"{% endif %}>
            {{ voter.display_name_breakable }}
        </span>
        <span class="d-none d-sm-block">
            {{ voter.display_name_breakable }}
        </span>
        </a>
    </th>

    <td class="text-center table-{{ voter.progress.registered.color }} px-3" style="white-space: nowrap">
        {% if voter.progress.registered.url %}
        <a href="{{ voter.progress.registered.url }}" target="_blank" class="text-decoration-none">
            {{ voter.progress.registered }}
        </a>
        {% else %}
        {{ voter.progress.registered }}
        {% endif %}
        <button class="btn btn-sm btn-outline-dark ms-2 p-1 py-0 d-lg-none" type="button"
            id="toggle-{{ voter.slug }}"
            data-bs-toggle="collapse" data-bs-target="#status-{{ voter.slug }}"
            aria-expanded="false" aria-controls="status-{{ voter.slug }}">
            â–¼
        </button>
    </td>

    {% if voter in recommended %}
    <td class="d-none d-lg-table-cell"></td> <!-- Absentee: Requested -->
    <td class="d-none d-lg-table-cell"></td> <!-- Absentee: Recieved -->
    <td class="d-none d-sm-table-cell"></td> <!-- Ballot: Available -->
    <td class="d-none d-md-table-cell"></td> <!-- Ballot: Completed -->
    <td class="d-none d-lg-table-cell"></td> <!-- Ballot: Sent -->
    <td class="d-none d-xl-table-cell"></td> <!-- Ballot: Returned -->
    <td class="d-none d-lg-table-cell"></td> <!-- Ballot: Recieved -->
    <td class="d-none d-md-table-cell"></td> <!-- Election: Deadline -->
    <td class=""></td> <!-- Election: Voted -->
    {% else %}

    <td class="text-center table-{{ voter.progress.ballot_available.color }} d-none d-sm-table-cell d-lg-none">
        {{ voter.progress.ballot_available }}
        {% if voter.ballot_url %}
        <a href="{{ voter.ballot_url }}{% if request.user != voter.user %}&share=all{% endif %}" class="text-decoration-none">ðŸ”—</a>
        {% endif %}
    </td>

    <!-- Absentee: Requested -->

    <td class="text-center table-{{ voter.progress.absentee_requested.color }} d-none d-lg-table-cell">
        {% if voter.progress.absentee_requested.url %}
        <a href="{{ voter.progress.absentee_requested.url }}" target="_blank" class="text-decoration-none">
            {{ voter.progress.absentee_requested }}
        </a>
        {% else %}
        {{ voter.progress.absentee_requested }}
        {% endif %}
    </td>

    <!-- Absentee: Recieved -->

    <td class="text-center table-{{ voter.progress.absentee_received.color }} d-none d-lg-table-cell">
        {{ voter.progress.absentee_received }}
    </td>

    <!-- Ballot: Available -->

    <td class="text-center table-{{ voter.progress.ballot_available.color }} d-none d-lg-table-cell">
        {{ voter.progress.ballot_available }}
        {% if voter.ballot_url %}
        <a href="{{ voter.ballot_url }}{% if request.user != voter.user %}&share=all{% endif %}" class="text-decoration-none">ðŸ”—</a>
        {% endif %}
    </td>

    <!-- Ballot: Completed -->

    <td class="text-center table-{{ voter.progress.ballot_completed.color }} d-none d-md-table-cell">
        {{ voter.progress.ballot_completed }}
    </td>

    <!-- Ballot: Sent -->

    <td class="text-center table-{{ voter.progress.ballot_sent.color }} d-none d-lg-table-cell">
        {{ voter.progress.ballot_sent }}
    </td>

    <!-- Ballot: Returned -->

    <td class="text-center table-{{ voter.progress.ballot_returned.color }} d-none d-xl-table-cell">
        {{ voter.progress.ballot_returned }}
    </td>

    <!-- Ballot: Recieved -->

    <td class="text-center table-{{ voter.progress.ballot_received.color }} d-none d-lg-table-cell">
        {{ voter.progress.ballot_received }}
    </td>

    <!-- Election: Deadline -->

    <td class="text-center table-{{ voter.progress.election.color }} d-none d-md-table-cell">
        {{ voter.progress.election.date_delta }}
    </td>

    <!-- Election: Voted -->

    <td class="text-center table-{{ voter.progress.voted.color }}">
        {{ voter.progress.voted.icon }}
    </td>

    {% endif %}

    <td>
        <div class="d-flex justify-content-center">
        <form>{% csrf_token %}
        <div class="input-group flex-nowrap">

        {% if voter.user == request.user and not referrer %}
            {% if voter.complete %}
            <a class="btn btn-secondary" href="{% url 'buddies:profile' %}">
                <span class="d-none d-md-inline text-nowrap">âžœ View Profile</span>
                <span class="d-none d-sm-inline d-md-none text-nowrap">âžœ View</span>
                <span class="d-inline d-sm-none">âžœ</span>
            </a>
            {% else %}
            <a class="btn btn-primary" href="{% url 'buddies:setup' %}">
                <span class="d-none d-md-inline text-nowrap">âœŽ Finish Setup</span>
                <span class="d-none d-sm-inline d-md-none text-nowrap">âœŽ Setup</span>
                <span class="d-inline d-sm-none">âœŽ</span>
            </a>
            {% endif %}
        {% elif voter in recommended %}
        <button class="btn btn-success"
            hx-post="{% url 'buddies:status' slug=voter.slug %}"
            hx-vals='{ "add": true }'
            hx-trigger="click"
            hx-target="closest tr"
            hx-swap="outerHTML">
            <span class="d-none d-md-inline text-nowrap">âŠ• Follow Voter</span>
            <span class="d-none d-sm-inline d-md-none text-nowrap">âŠ• Follow</span>
            <span class="d-inline d-sm-none">âŠ•</span>
        </button>
        <button class="btn btn-danger"
                hx-post="{% url 'buddies:status' slug=voter.slug %}"
                hx-vals='{ "ignore": true }'
                hx-trigger="click"
                hx-target="closest tr"
                hx-swap="delete">
                âœ•
        </button>
        {% elif voter.complete %}
        <a class="btn btn-{% if voter.progress.actions %}primary{% else %}secondary{% endif %} text-nowrap"
            href="{% url 'buddies:friends-profile' slug=voter.slug %}?email=true">
            <span class="d-none d-md-inline text-nowrap">@ Send Email</span>
            <span class="d-none d-sm-inline d-md-none text-nowrap">@ Email</span>
            <span class="d-inline d-sm-none">@</span>
        </a>
        {% else %}
        <a class="btn btn-primary" href="{% url 'buddies:friends-setup' slug=voter.slug %}">
            <span class="d-none d-md-inline text-nowrap">âœŽ Finish Setup</span>
            <span class="d-none d-sm-inline d-md-none text-nowrap">âœŽ Setup</span>
            <span class="d-inline d-sm-none">âœŽ</span>
        </a>
        {% endif %}

        </div>
        </form>
        </div>
    </td>

</tr>

<tr class="collapse" id="status-{{ voter.slug }}">
    <td colspan="100%" class="pt-3 pb-0 px-2">
        {% include "profile/_table.html" %}
    </td>
</tr>

<script>

var collapsible = document.getElementById('status-{{ voter.slug }}')

collapsible.addEventListener('show.bs.collapse', function () {
    button = document.getElementById('toggle-{{ voter.slug }}')
    button.innerText = 'â–²'
})

collapsible.addEventListener('hidden.bs.collapse', function () {
    button = document.getElementById('toggle-{{ voter.slug }}')
    button.innerText = 'â–¼'
})

</script>
